<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>予約帯表示（レスポンシブ対応版）</title>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Zen Maru Gothic', sans-serif; margin: 20px; }
  .canvas-container {
    overflow-x: auto;
    border: none;
  }
  canvas { display: block; width: 100%; height: auto; }
  button { margin: 0 5px; }
  #currentDateInput {
    border: none;
    font-size: 16px;
    padding: 3px 5px;
    margin-left: 5px;
  }
  button:focus{
    outline: none;
  }
    #currentDateInput {
    border: none;
    background: none;
    font-size: 16px;
    padding: 3px 5px;
  }
  #currentDateInput:focus {
    outline: none;
  }
</style>
</head>
<body>

<div style="margin-bottom: 10px;">
  <button id="prevDay">&lt; 前日</button>
  <input type="date" id="currentDateInput">
    <span id="currentDayOfWeek"></span>
  <button id="nextDay">翌日 &gt;</button>
  <span id="currentDayOfWeek" style="margin-left:10px;"></span>
</div>

<div class="canvas-container">
  <canvas id="calendar" height="300"></canvas>
</div>

<script>
const canvas = document.getElementById('calendar');
const ctx = canvas.getContext('2d');
const dpr = window.devicePixelRatio || 1;

const seats = ['デスクのみ','液晶タブレット席A','液晶タブレット席B','PC席','グループ席','1階オープン席'];
const openHour = 10; 
const closeHour = 23; 
const rowHeight = 50;
const rowPadding = 10;
const leftMargin = 100;

let currentDate = new Date();
const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSm9nHk-m5zuNiUamjLcGIw0W4Q4JRL7NbqVPBSzCXlP7_LHPZgckwxebS_1j_lBYApx71hXXeaRbUx/pub?output=csv';

const currentDateInput = document.getElementById('currentDateInput');
const currentDayOfWeek = document.getElementById('currentDayOfWeek');

function updateDateDisplay() {
  const y = currentDate.getFullYear();
  const m = String(currentDate.getMonth() + 1).padStart(2,'0');
  const d = String(currentDate.getDate()).padStart(2,'0');
  currentDateInput.value = `${y}-${m}-${d}`;

  const days = ['日','月','火','水','木','金','土'];
  currentDayOfWeek.textContent = `(${days[currentDate.getDay()]})`;
}

currentDateInput.addEventListener('change', (e) => {
  currentDate = new Date(e.target.value);
  updateCalendar();
});
document.getElementById('prevDay').addEventListener('click', () => {
  currentDate.setDate(currentDate.getDate() - 1);
  updateCalendar();
});
document.getElementById('nextDay').addEventListener('click', () => {
  currentDate.setDate(currentDate.getDate() + 1);
  updateCalendar();
});

function resizeCanvas() {
  canvas.width = canvas.parentElement.clientWidth;
  canvas.height = rowHeight * seats.length + 40;
}

window.addEventListener('resize', () => {
  resizeCanvas();
  updateCalendar();
});

function drawRoundedRect(x, y, width, height, radius, color) {
  ctx.fillStyle = color;
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.lineTo(x + width - radius, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
  ctx.lineTo(x + width, y + height - radius);
  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
  ctx.lineTo(x + radius, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
  ctx.lineTo(x, y + radius);
  ctx.quadraticCurveTo(x, y, x + radius, y);
  ctx.closePath();
  ctx.fill();
}

function drawTimeAxis() {
  const startHour = 9;
  const hours = 24 - startHour;
  const widthPerHour = (canvas.width - leftMargin) / hours;

  const openX = leftMargin + (openHour - startHour) * widthPerHour;
  const closeX = leftMargin + (closeHour - startHour) * widthPerHour;
  ctx.fillStyle = '#FFF8E8'; // クリーム色
  ctx.fillRect(openX, 20, closeX - openX, rowHeight * seats.length);

  ctx.font = '12px "Zen Maru Gothic", sans-serif';
  ctx.textAlign = 'center';

  for (let h = startHour; h <= 24; h++) {
    if (h === 9) continue; // 9時はスキップ
    
    const x = leftMargin + (h - startHour) * widthPerHour;
    ctx.beginPath();
    ctx.lineWidth = (h === openHour || h === 20 || h === closeHour) ? 1 : 0.5;
    ctx.strokeStyle = (h === 20) ? 'orange' : '#bbb';
    ctx.moveTo(x, 20);
    ctx.lineTo(x, rowHeight * seats.length + 20);
    ctx.stroke();

    if (h !== 9 && h !== 24) {
      ctx.fillStyle = '#000';
      ctx.fillText(`${h}:00`, x, 12);
    }
  }
}

function updateCalendar() {
  resizeCanvas();
  updateDateDisplay();

  fetch(csvUrl)
    .then(res => res.text())
    .then(csvText => {
      const rows = csvText.trim().split('\n').slice(1);
      const reservations = rows.map(r => {
        const [seat, date, start, end, holiday] = r.split(',');
        return {
          seat: seat.trim(),
          date: date.trim(),
          start: start ? parseFloat(start) : null,
          end: end ? parseFloat(end) : null,
          holiday: holiday ? holiday.trim() : ''
        };
      });

      const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}-${String(currentDate.getDate()).padStart(2,'0')}`;
      const todaysRes = reservations.filter(r => r.date.replace(/\//g,'-') === dateStr);

      const dayOfWeek = currentDate.getDay();
      const isThursday = (dayOfWeek === 4);
      const isHolidayFlag = todaysRes.some(r => r.holiday === '1');
      const isHoliday = isThursday || isHolidayFlag;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawTimeAxis();

      if (isHoliday) {
        ctx.fillStyle = '#FFF8E8'; 
        ctx.fillRect(leftMargin, 20, canvas.width - leftMargin, rowHeight * seats.length);
        ctx.fillStyle = '#ED7483'; 
        ctx.font = '80px "Zen Maru Gothic", sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('休業日', canvas.width/2, canvas.height/2);
        return;
      }

      seats.forEach((seat, i) => {
        const y = i * rowHeight + rowPadding + 20; 
        const seatRes = todaysRes.filter(r => r.seat === seat && r.start !== null && r.end !== null) 
                                  .sort((a,b) => a.start - b.start);
       
        seatRes.forEach(r => {
          drawRoundedRect(
            leftMargin + (r.start - 9) * (canvas.width - leftMargin) / 15,
            y + 8,
            (r.end - r.start) * (canvas.width - leftMargin) / 15,
            rowHeight - rowPadding*3,
            15,
            '#9C7451' 
          );
        });

        ctx.fillStyle = 'black';
        ctx.font = '14px "Zen Maru Gothic", sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText(seat, 10, y + 14);
      });
    })
    .catch(err => console.error('CSV読み込みエラー:', err));
}

updateCalendar();
</script>

</body>
</html>

















